## 租房列表页迁移需求概要

### 项目背景

* 租房列表页现在仍然处在老的代码仓库中，有较多的代码冗余和过期(作废)的业务逻辑，基于不合理代码基础上的临时改装等，造成旧业务难以维护，新业务难以优化。因此急需将列表页业务迁移到新仓库中。

* 由于迁移需求比较紧急，需要快速上线迭代，快速完成迁移以实现租房列表新业务的需求。

* 前端样式基本遵照二手房列表页样式统一。

* 列表页直接影响房源曝光和精选位置的出现和扣费，需要DW参与上线后监控。

### 需求设计

#### 首屏功能

* 全站导航栏
    * 首页
    * 新房
    * 二手房
    * 卖房
    * 租房
    * 商业地产
    * 房价
    * 问答
    * 经纪人登陆
    * 用户登陆/注册
    * 收藏夹
* logo
* 城市下拉框
* 搜索框及按钮
* 地图找房入口
* 列表页导航
    * 房源
    * 小区
    * 地图找房
* 列表页副导航
    * 面包屑
    * 免费发布房源按钮 `需要UI`
* 筛选区
* 列表标签
    * 全部
    * 100%个人房源
    * 经纪人房源
* 广告位
* 列表
    * 排序
        * 默认
        * 租金(升序/降序)
        * 最新(降序/升序)
* 分页
* 底部推荐
* 内链模块


#### 列表页URL

* 租房列表页URL在筛选项、导航入口、分页上的构造规则均有差异，`需要产品和SEO确认`

#### 搜索模块

* 搜索框

    * 默认灰色字体展示

    ```
    请输入房源特征、地址、小区、楼盘名或…
    ```

    * `高亮逻辑待确认`

    * 搜索词联想
        * 联想小区名+对应小区租房房源套数
        * 联想小区名中，对应搜索词斜体表示
        * 输入小区名时，如果匹配多个小区，在输入框下方提示"您是不是找"(如搜索'东丽温泉家园')
         

#### 筛选模块
 
* 默认/区域找房时筛选项显示为`区域`、`租金`、`房型`；
* 地铁找房时筛选项显示为`地铁`、`步行`、`租金`、`房型`，其中租金支持用户自定义最大值与最小值；
* 更多筛选项为下拉框，为`房屋类型`、`装修`；
* 当合租复选框被勾选时，展示`独立卫生间`、`阳台`、`朝南`复选框；
 
 
#### 房源模块

* 房源模块样式参照二手房模块样式 `需要UI`

* 房源置顶

  * 列表页url带ajkid参数时，如果可以通过获取租房房源信息，将该房源置顶展示。[pmt-27465](http://p.corp.anjuke.com/project/detail?id=27465)

* 加码

  * 仅第一页在进单页时加码，from值为`Filter_{列表页房源序号}`

* 展示的信息主要有：`标题`、`室厅`、`租赁类型`、`装修`、`楼层`、`小区`、`区域板块`、`地址`、`客户(经纪人/个人)姓名`、`房源价格(单位 元/月)`、`补充房源属性`

  * 客户信息部分
      * 经纪人房源：显示经纪人姓名
      * 个人房源：显示"个人房源"
      * 58个人认证房源：优先展示客户姓名，无法获取时显示"个人房源"

  * 补充房源属性部分：
      * "地铁房"属性：迁移BLL_Community_CommunityMetro::get_nearby_metros方法
      * "紧邻"属性：同上

  * 搜索词高亮

* 房源标签
 
  * 标题后标签现在有4类：`多图`、`主推`、`急售`、`品牌公寓`
      * 多图：房源被计算为高质量房源，对应content_basic字段json中的quality字段{true:多图房源,false:非多图}；
      * 主推：broker_db.ad_set_rent获取经纪人是否购买橱窗位置，通过broker_db.ad_props_show_rent获取经纪人最新的前5套主推房源id，即为主推房源；
      * ~~急售：order_string = 80~~
      * 品牌公寓：anjuke_db.ajk_owner_prop中存在有效记录的房源

  * 价格下标签现在有2类：`58-已认证个人房源`、`免佣-100%真无中介`

* 分页逻辑

  * 无最大分页限制

  * 样式以UI为准 `需要UI`

#### 精选展示逻辑

* 以 [pmt:27698](http://p.corp.anjuke.com/project/detail?id=27698) 为最新逻辑(如有新增逻辑请今后的开发同学注明跳转)

* 涉及页面

| 列表类型 | 
| --- |
| PC默认列表页 |
| 搜索结果页 |
| 筛选结果页 |


* 展示逻辑

搜索 | 展示数量
--- | ---
精确命中板块词 | `全部`
模糊 | `30`


筛选(搜索+筛选) | 展示数量
--- | ---
板块+价格 | `20`
其他 | `30`


* 58个人认证房源插入第一页的 __7、14、21、28、35、42、49__ 位置，被占用位置的精选和套餐房源相对顺延


#### 广告位

* ifx广告位(`需要前端配合`)

* 百度广告位(`需要前端配合`)


#### 交互类需求

* `需要UI`


#### SOJ发送

* PC租房列表页发送soj参数如下


```
p:Listing_V2_IndexPage_All
h:http://sh.zu.anjuke.com/?from=navigation
r:http://user.anjuke.com/my/login?history=aHR0cDovL3NoLnp1LmFuanVrZS5jb20vP2Zyb209bmF2aWdhdGlvbg==
site:anjuke
guid:73580990-DB05-22DA-215C-21612AC7D907
ssid:29101C48-C384-AE1A-C4EF-TFAD06242046
uid:4192887
t:1435300661092
ctid:11
luid:4192887:1
m:
pn:Listing_V2_IndexPage_All
cp:{
    "v": "2.0",
    "tradeType": "2",
    "userType": "1",
    "hpPage": "Haozu_Hp_View",
    "channel": "3",
    "entry": "1",
    "commid": "0",
    "userid": "4192887",
    "result": "1547120",
    "proids": "41725102|1453519|85|1,41743328|1790232|189916|1,41760635|2279191|27|1,41865609|1656824|305|1,41960935|2347389|162|1,42021332|1524518|1283|1,F49907258|0|5239|1,42048460|1425210|344397|1,42304189|1590096|413|1,42355782|2347060|62202|1,42377572|2017157|75015|1,42378978|2017157|75015|1,42411660|2363250|1777|1,F51922255|0|9839|1,42411458|2363250|1777|1,42458970|1982401|2500|1,42460946|1877674|650263|1,42499203|2366883|5769|1,42030833|2122129|116663|1,42168963|1772023|3761|1,F52025148|0|639347|1,42290381|2363979|0|1,42342051|1624197|16027|1,41865726|1656824|6090|1,42286981|1453900|544616|1,42243744|2004807|292026|1,42289804|2363979|217240|1,F52025157|0|5077|1,42388294|1971746|85673|1,42400234|1562325|7280|1,42012731|1939960|16554|1,41865469|1656824|305|1,41904149|1502823|3883|1,41918039|2312731|263435|1,F41811936|0|12881|1,41924029|1502823|596150|1,41909739|2122214|27|1,41899982|1467927|6302|1,41943992|1986601|7620|1,41912402|2122214|6|1,41974092|1602565|2026|1,F51930298|0|330314|1,42292745|1445048|75468|1,42276619|1716194|856|1,42235549|1624197|14255|1,42359005|1554885|378|1,42407975|1455446|1731|1,41771345|2335842|5560|1,F51932933|0|330314|1,41803921|2349998|63519|1,41896201|1529960|261051|1,41842191|2055821|4734|1,41899903|1467927|6533|1,41907203|1502823|266825|1,41910603|2122214|27|1,42011963|1939960|4959|1,42338837|2365901|4959|1"
}
```

