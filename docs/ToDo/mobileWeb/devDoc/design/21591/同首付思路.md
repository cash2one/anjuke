## 同首付需求
* 同首付推荐
    * 描述：
        * 功能：推荐与本房源同区域、板块、总价上下差距5%以内的房源。
        * 点击行为：点击“附近同首付房源推荐”，在新页面打开筛选列表页，筛选上的区域和板块呈选中状态，筛选栏下有一行推荐说明，如下：
            * 区域板块选中
            * 价格不限
            * 房型不限
            * 橙色提示条 `同首付房源x套      清除`
        * 此状态下继续进行筛选时，同首付条件保留。
        * 点击清除后，同首付条件清除，筛选条件保留，即恢复为正常二手房房源列表。
        * 竞价逻辑遵循二手房列表筛选后逻辑，展示5套竞价房源，其余为定价房源。若清除条件后筛选条件也为空，则相当于默认列表，遵循二手房列表默认竞价逻辑。
        * 若附近同首付推荐结果少于10套，遵循筛选零少结果推荐逻辑，回退条件顺序为板块 > 区域 ，若区域条件清空结果仍少于10套，则在推荐结果下增加“猜你喜欢”模块；若区域条件清空结果为0套，则显示零结果文案，并推荐“猜你喜欢”模块。若猜你喜欢数据为0，则展示默认rank，文案为“为您推荐的相似房源”。


---
## 同首付列表

##### 方案1: 筛选条件添加隐藏默认项，房源价格区间覆盖 price 查询标记，可能存在注入危险

##### 方案2:
* 用户点击`同首付推荐`的时候访问推荐url；

* 推荐uri 与 列表页uri 相同：

    ```
    http://shanghai.anjuke.com/sale/
    ```

    参数 | 说明
    --- | ---
    similar | 是否进入筛选同首付模式 {0:缺省，非同首付列表, 1:请求同首付列表}


* 首付获取形式
    * 方案1 : 房源id => [(memcache)房源信息 ->]房源首付值 -> 构造同首付价格区间(设计公共方法) -> 调用筛选方法获取列表；
    * 方案2 : 传递当前房源单页的房源首付金+区域板块码 => 后端构造同首付价格区间(设计公共方法) -> 构造`price`和`area_code`参数 -> solr请求并返回房源条数；

* 筛选项
    * 用户选择`区域板块`时<b>保留</b>`同首付推荐参数`；
    * 用户选择`价格区间`时<b>清除</b>`同首付推荐参数`；
    * 用户选中`房型`时<b>保留</b>`同首付推荐参数`；

---
## 需求和设计对应关系

* 单页
    * 显示该房源的同板块同首付房源数
        * 采用异步方式获取
        * http://shanghai.anjuke.com/ajax/dpsimilar/?price=1300000&area_code=000010000200003
        * 返回类型{status:1, similar:400}
    * 跳转到同首付房源列表
        * 构造url http://shanghai.anjuke.com/sale/xujiahui/?similar=1&price=1300000[&from=xxx][&asc=xxx]

* 列表页
    * 控制器根据 similar 参数改变列表规则为同首付推荐
    * 控制器通过 similar 参数获取房源首付价格构造价格区间并拼入solr查询
    * 控制器喷出`同首付价格区间`供筛选项显示
    * 控制器喷出`is_similar`参数，控制显示同首付副标题框

* 业务类
    * 需要一个类，负责通过 `price + area_code` 获取同区域板块的同首付房源数(int)
        * 提供一个ajax控制器
        * 通过构造价格区间 + 板块的搜索参数获取同板块同首付房源数量
    * 需要一个类，负责通过 `房源id+筛选项(区域/板块/房型)` 获取同首付房源列表(array)
        * 通过参数 `similar` 是否有值，分发`常规列表`和`同首付列表`
        * 改造控制器的search_params可以实现 `price` 的嵌入
