# PPC 扣费概要设计

## 待做事项

* 找拱平确认 扣费使用版本 V3.0
* 通知相关人员技术实现方案变更
    * 莎莎、拱平、BI
* 找平增加TOUCH的参数
    * PN:Anjuke_Prop_View
    * SITE:m_anjuke
* 分布上线实现方案

### 扣费方案

* 去除原有的 click 扣费调用移动API请求
* 合并两个请求为一个 只往SOJ那个请求发数据  http://s.anjuke.com/stb  发送cp扣费参数
* 原有的SOJ请求参数与参数获取方式不变（由前端自己获取封装 JOCKJS 实现） 
* 扣费参数由后端生成 写入头信息中
    * Data-Ppc:json字符串

* 扣费参数
    * v:3.0 (扣费协议版本)
    * channel:7 (渠道来源)
    * userId:用户ID
    * userType:用户类别
    * tradeType:1   (房源类型)
    * proId:房源Id
    * COMMID:小区ID
    * brokerId:经纪人ID
    * brokerType:2 (经纪人类型)
    * hpType:好盘类型  1【PPC定价或者新端口套餐】2【PPC竞价或者新精选】3【老端口套餐】
        * 值怎么获取
    * entry:点击房源来源展示点
        * 这个值怎么定义 原先TOUCH WEB API统一值 123
        * 首页 历史推荐
        * 列表页
        * 单页 附近推荐
        * 单页 猜你喜欢
        * 单页 附近地铁房
        * 单页 下一套
    * invalid:标识是否无效点击 1:无效点击
    * ir:恶意点击具体原因 
        * 1:着陆页为二手房房源单页且着陆页的refferer为空的人访问的二手房房源单页中的refferer为空的,判断为无效点击
        * 2:着陆页为二手房过期单页且refferer为空的人访问的二手房过期单页中的refferer为空的,判断为无效点击
        * 5:二手房搜索经纪人姓名,搜索结果列表页的房源点击无效
        * 6:二手房搜索经纪人手机号码,搜索结果列表页的房源点击无效
        * 112:X项目点击卡片至房源单页点击无效
            * 规则 |/sale/x/[0-9]{2}/[0-9]+|

* 分布上线
    * 新版上线城市 苏州
    * 后端加城市判断 往对应城市的页面写入头信息
    * 前端读取有无头信息 无则使用旧的扣费规则 有则使用新的

